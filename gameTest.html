<img src="img/trash.png" id="trashCan" height= "20" width="42">
<!--
<img src="img/paper_ball.png" id="styrofoam">
<img src="img/paper_ball.png" id="paper">
<img src="img/paper_ball.png" id="plastic">
-->
<link rel="stylesheet" type="text/css" href="gameTest.css">
score:<div id = "displayScore"></div>
</div>
<script src="js/lib.js"></script>
<script>
let trash = [];
let displayScore = document.getElementById("displayScore");
var score = 0;
var lives = 3;
let testObj=document.getElementById("trashCan");
testObj.style.position="absolute"

customElements.define('game-trash',
  class extends HTMLElement {
    constructor() {
      super();
    }
    connectedCallback(){
        this.class="trash";
        this.img = document.createElement("img");
        this.img.setAttribute('height', '100px');
        this.img.setAttribute('width', '100px');

        this.y=0;
        this.style.position="absolute";
        this.style.left=(Math.random()*600)+"px";
        this.style.top="0px";
        this.typeNum = Math.ceil(Math.random()*3);
        if (this.typeNum == 1){
          this.type = "Paper";
          this.img.setAttribute('src', 'img/paper_ball.png');
        } else if (this.typeNum == 2){
          this.type = "Styrofoam";
          this.img.setAttribute('src', 'img/styrofoam.png');
        } else if (this.typeNum == 3){
          this.type = "Plastic";
          this.img.setAttribute('src', 'img/plastic.png');
        }
        this.appendChild(this.img);
        //document.body.appendChild(this);
        requestAnimationFrame(() => {
                this.draw(this);
        });
    }
    draw(self){
        if(self.y>innerHeight){
          document.body.removeChild(self);
          trash.shift();
        }
        self.y+=5;
        self.style.top=self.y+"px";
        requestAnimationFrame(()=>{self.draw(self)});
    } 
})
let dropTrash = setInterval(function(){
  produceTrash();
},1500)
let TrashCan = {
  x: 300,
  y: innerHeight-100
}

function incrementScore(){
  for(let a=0;a<trash.length;a++){
    if (trash[a].y > TrashCan.y){
      if (Math.abs(trash[a].x - TrashCan.x) < 100){
        score += 1;
      }
      else{
        lives -=1;
      }
    }
    if (lives == 0){
      gameOver();
    }
  }
}
let gameOver = () =>{

}

window.requestAnimationFrame(draw);
function draw() {
  move();
  incrementScore();
  displayScore.innerText = score;
  window.requestAnimationFrame(draw);
}

let move = () =>{
  if(KeyIsDown("ArrowLeft")){
    //do something
    TrashCan.x-=5;
  }
  if(KeyIsDown("ArrowRight")){
    TrashCan.x+=5;

  }
  if(testObj.x>innerWidth)testObj.x=innerWidth;
  if(testObj.x<0)testObj.x=0;
  testObj.style.left=TrashCan.x+"px";
  testObj.style.top=TrashCan.y+"px";
}
let produceTrash = () =>{
    trash.push(document.body.appendChild(document.createElement("game-trash")));

}
</script>